var init=null;!function(t){init=function(e){function a(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+t+"=([^&#]*)",n=new RegExp(a),l=n.exec(e);return null==l?"":decodeURIComponent(l[1].replace(/\+/g," "))}function n(){t.getJSON(o+"ajaxGetNotes.php",function(t){i.empty();var e=null,a=0,n=t.length,l=null,o={};for(a;n>a;a++)l=t[a],(null==e||e!=l.tag)&&(e=l.tag,o[e]=[]),o[e].push(l);var d=Math.floor(p.width()/u);c>=d&&(d=c);var g=Math.ceil(n/d);s>=g&&(g=s);var f=i.append('<div class="col"/>').find(":last");a=0;for(var h in o)o.hasOwnProperty(h)&&(a>=g&&(f=i.append('<div class="col"/>').find(":last"),a=0),f.append(r({tag:h,size:o[h].length,data:o[h]})),a+=o[h].length);i.append('<div class="clear"/>')})}function l(){var e={};if(e.text=t("#newText").val(),e.tag=t("#newCategory").val(),e.text&&e.tag){var a=JSON.stringify(e);t.ajax({url:o+"ajaxCreateNote.php",type:"POST",dataType:"json",data:{payload:a},success:function(){t("#newText").val(""),t("#newText").focus(),n()}})}}var r=null,i=t("#noteList"),o=e.pagesPath,s=e.colHeight,c=4,u=260,p=t("#content"),d=t("#data-template").html();r=Handlebars.compile(d),Handlebars.registerHelper("chkBoxHelper",function(t){return t?" CHECKED":""}),t("#tagDlg").dialog({autoOpen:!1,buttons:{OK:function(){var e=t("#tagDlg td.tdOldVal").html(),a=t("#tagDlg input").val();e&&a&&t.ajax({url:o+"ajaxChangeTag.php",type:"POST",dataType:"json",data:"old="+e+"&new="+a,success:function(){n()}}),t(this).dialog("close")}}}),t("#newPost input").bind("keypress",function(t){return 13==t.keyCode?(l(),t.preventDefault(),!1):void 0}),t("#newNoteButton").button().click(function(t){return l(),t.preventDefault(),!1}),i.on("click",function(e){var l=t(e.target);if(l.is("a.deletePost")||l.is("a.deletePost img")){var r="",i="";return r=l.is("a.deletePost")?l.attr("href"):l.parent().attr("href"),i=a("id",r),t.ajax({url:o+"ajaxDeleteNote.php",type:"GET",dataType:"json",data:"id="+i,success:function(t){"OK"===t.status&&n()}}),e.preventDefault(),!1}if(l.is("input:checkbox")){var s=t(e.target).attr("id"),c=s.indexOf("-"),u=s.substring(0,c),p=0;l.is(":checked")&&(p=1),t.ajax({url:o+"ajaxCheckUncheckNote.php",type:"GET",dataType:"json",data:"id="+u+"&checked="+p,success:function(){n()}})}else{if(l.is("h2 a"))return t("#newCategory").val(l.html()),t("#newText").focus(),e.preventDefault(),!1;if(l.is("a.editTag")){var r=l.attr("href"),d=a("tag",r);return t("#tagDlg").dialog("open"),t("#tagDlg td.tdOldVal").html(d),t("#tagDlg input").val("").focus(),e.preventDefault(),!1}}}),n()}}(jQuery);